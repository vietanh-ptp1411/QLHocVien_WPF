<UserControl x:Class="QL_MVALab.View.Views_HocPhiView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="800"
             d:DesignWidth="1200">

    <!-- ========== Styles ========== -->
    <UserControl.Resources>
        <Style TargetType="Button">
            <Setter Property="Margin"
                    Value="5" />
            <Setter Property="Padding"
                    Value="10,5" />
            <Setter Property="MinWidth"
                    Value="80" />
            <Setter Property="Height"
                    Value="32" />
            <Setter Property="FontWeight"
                    Value="SemiBold" />
            <Setter Property="BorderThickness"
                    Value="1" />
            <Setter Property="Cursor"
                    Value="Hand" />
        </Style>

        <Style TargetType="TextBox">
            <Setter Property="Margin"
                    Value="5" />
            <Setter Property="Padding"
                    Value="8,5" />
            <Setter Property="Height"
                    Value="28" />
            <Setter Property="BorderThickness"
                    Value="1" />
            <Setter Property="BorderBrush"
                    Value="#CCCCCC" />
            <Style.Triggers>
                <Trigger Property="IsFocused"
                         Value="True">
                    <Setter Property="BorderBrush"
                            Value="#2196F3" />
                    <Setter Property="BorderThickness"
                            Value="2" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="ComboBox">
            <Setter Property="Margin"
                    Value="5" />
            <Setter Property="Padding"
                    Value="8,5" />
            <Setter Property="Height"
                    Value="32" />
            <Setter Property="BorderThickness"
                    Value="1" />
            <Setter Property="BorderBrush"
                    Value="#CCCCCC" />
            <Style.Triggers>
                <Trigger Property="IsFocused"
                         Value="True">
                    <Setter Property="BorderBrush"
                            Value="#2196F3" />
                    <Setter Property="BorderThickness"
                            Value="2" />
                </Trigger>
                <Trigger Property="IsEnabled"
                         Value="False">
                    <Setter Property="Background"
                            Value="#F5F5F5" />
                    <Setter Property="Foreground"
                            Value="#999999" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="Label">
            <Setter Property="Margin"
                    Value="5,8,5,2" />
            <Setter Property="FontWeight"
                    Value="SemiBold" />
            <Setter Property="Foreground"
                    Value="#333333" />
        </Style>

        <Style TargetType="DatePicker">
            <Setter Property="Margin"
                    Value="5" />
            <Setter Property="Height"
                    Value="32" />
            <Setter Property="BorderThickness"
                    Value="1" />
            <Setter Property="BorderBrush"
                    Value="#CCCCCC" />
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <!-- Header -->
            <RowDefinition Height="Auto" />
            <!-- Search -->
            <RowDefinition Height="*" />
            <!-- Content -->
        </Grid.RowDefinitions>

        <!-- ========== Header ========== -->
        <Border Grid.Row="0"
                Background="#2196F3"
                Padding="15">
            <DockPanel LastChildFill="False">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="💰"
                               FontSize="28"
                               VerticalAlignment="Center"
                               Margin="0,0,10,0" />
                    <TextBlock Text="QUẢN LÝ HỌC PHÍ"
                               FontSize="24"
                               FontWeight="Bold"
                               Foreground="White"
                               VerticalAlignment="Center" />
                </StackPanel>
                <Button Content="🔄 Làm mới"
                        DockPanel.Dock="Right"
                        Command="{Binding RefreshCommand}"
                        Background="Transparent"
                        Foreground="White"
                        BorderBrush="White"
                        BorderThickness="2"
                        Margin="20,0,0,0"
                        Padding="15,5" />
            </DockPanel>
        </Border>

        <!-- ========== Search bar ========== -->
        <Border Grid.Row="1"
                Background="#F8F9FA"
                Padding="15"
                BorderBrush="#E0E0E0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                           Text="🔍 Tìm kiếm:"
                           VerticalAlignment="Center"
                           Margin="0,0,15,0"
                           FontWeight="SemiBold"
                           FontSize="14" />
                <TextBox Grid.Column="1"
                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                         FontSize="14"
                         x:Name="SearchTextBox" />
                <Border Grid.Column="2"
                        Background="#E3F2FD"
                        CornerRadius="15"
                        Padding="12,6"
                        Margin="15,0,0,0">
                    <TextBlock Text="{Binding FilteredHocPhiList.Count, StringFormat='Tìm thấy: {0} bản ghi'}"
                               VerticalAlignment="Center"
                               FontStyle="Italic"
                               FontWeight="SemiBold"
                               Foreground="#1976D2" />
                </Border>
            </Grid>
        </Border>

        <!-- ========== Main Content ========== -->
        <Grid Grid.Row="2"
              Margin="15"
              Background="White">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="420" />
                <!-- Form -->
                <ColumnDefinition Width="*" />
                <!-- Grid -->
            </Grid.ColumnDefinitions>

            <!-- ===== Form nhập ===== -->
            <GroupBox Grid.Column="0"
                      Margin="0,0,10,0"
                      BorderBrush="#90CAF9"
                      BorderThickness="2">
                <GroupBox.Header>
                    <TextBlock Text="📋 THÔNG TIN HỌC PHÍ"
                               FontSize="16"
                               FontWeight="Bold"
                               Foreground="#1976D2"
                               Margin="5" />
                </GroupBox.Header>
                <ScrollViewer VerticalScrollBarVisibility="Auto"
                              Padding="10">
                    <StackPanel>

                        <!-- ID (chỉ đọc) -->
                        <Border Background="#F0F8FF"
                                BorderBrush="#B3E5FC"
                                BorderThickness="1"
                                CornerRadius="5"
                                Padding="10"
                                Margin="0,0,0,10">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="🆔 ID:"
                                           FontWeight="Bold"
                                           VerticalAlignment="Center"
                                           Width="60" />
                                <TextBlock Text="{Binding Id, TargetNullValue='[Mới]'}"
                                           VerticalAlignment="Center"
                                           FontWeight="Bold"
                                           FontSize="14"
                                           Foreground="#1976D2" />
                            </StackPanel>
                        </Border>

                        <!-- Chọn lớp học -->
                        <Label Content="🏫 Chọn lớp học *"
                               Foreground="#D32F2F" />
                        <ComboBox ItemsSource="{Binding LopHocList}"
                                  SelectedItem="{Binding SelectedLopHoc, Mode=TwoWay}"
                                  DisplayMemberPath="TenLop"
                                  ToolTip="Chọn lớp học để xem danh sách học viên">
                            <!--<ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding TenLop}"
                                               FontWeight="SemiBold" />
                                </DataTemplate>
                            </ComboBox.ItemTemplate>-->
                        </ComboBox>

                        <!-- Chọn học viên -->
                        <Label Content="👤 Chọn học viên *"
                               Foreground="#D32F2F" />
                        <ComboBox ItemsSource="{Binding HocVienList}"
                                  SelectedItem="{Binding SelectedHocVien, Mode=TwoWay}"
                                  DisplayMemberPath="HoTen"
                                  ToolTip="Chọn học viên trong lớp đã chọn">
                            <!--<ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding HoTen}"
                                               FontWeight="SemiBold" />
                                </DataTemplate>
                            </ComboBox.ItemTemplate>-->
                            <ComboBox.Style>
                                <Style TargetType="ComboBox"
                                       BasedOn="{StaticResource {x:Type ComboBox}}">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedLopHoc}"
                                                     Value="{x:Null}">
                                            <Setter Property="IsEnabled"
                                                    Value="False" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ComboBox.Style>
                        </ComboBox>

                        <!-- Thông tin đăng ký -->
                        <Label Content="ℹ️ Thông tin đăng ký:" />
                        <Border Background="#F8F9FA"
                                BorderBrush="#DEE2E6"
                                BorderThickness="1"
                                CornerRadius="5"
                                Padding="12"
                                MinHeight="80">
                            <StackPanel>
                                <TextBlock VerticalAlignment="Center"
                                           TextWrapping="Wrap">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Text"
                                                    Value="{Binding HoTen, StringFormat='👤 Học viên: {0}'}" />
                                            <Setter Property="Foreground"
                                                    Value="#28A745" />
                                            <Setter Property="FontWeight"
                                                    Value="SemiBold" />
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding HoTen}"
                                                             Value="">
                                                    <Setter Property="Foreground"
                                                            Value="#6C757D" />
                                                    <Setter Property="Text"
                                                            Value="💡 Vui lòng chọn lớp học và học viên" />
                                                    <Setter Property="FontWeight"
                                                            Value="Normal" />
                                                    <Setter Property="FontStyle"
                                                            Value="Italic" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>

                                <TextBlock Text="{Binding TenLop, StringFormat='🏫 Lớp: {0}'}"
                                           Margin="0,5,0,0"
                                           Foreground="#007BFF"
                                           FontWeight="SemiBold">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding TenLop}"
                                                             Value="">
                                                    <Setter Property="Visibility"
                                                            Value="Collapsed" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>

                                <TextBlock Text="{Binding DangKyId, StringFormat='📝 Mã ĐK: {0}'}"
                                           Margin="0,5,0,0"
                                           Foreground="#6F42C1"
                                           FontSize="12"
                                           FontWeight="SemiBold">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding DangKyId}"
                                                             Value="{x:Null}">
                                                    <Setter Property="Visibility"
                                                            Value="Collapsed" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding DangKyId}"
                                                             Value="0">
                                                    <Setter Property="Visibility"
                                                            Value="Collapsed" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>
                        </Border>

                        <!-- Kỳ thu tiền -->
                        <Label Content="🔢 Kỳ thu tiền thứ *"
                               Foreground="#D32F2F" />
                        <TextBox Text="{Binding KyThu, UpdateSourceTrigger=PropertyChanged}"
                                 ToolTip="Nhập số thứ tự kỳ thu tiền (1, 2, 3...)" />

                        <!-- Số buổi đóng -->
                        <Label Content="📅 Số buổi đóng" />
                        <TextBox Text="{Binding SoBuoi, UpdateSourceTrigger=PropertyChanged}"
                                 ToolTip="Số buổi học đã đóng tiền" />

                        <!-- Số tiền -->
                        <Label Content="💰 Số tiền *"
                               Foreground="#D32F2F" />
                        <TextBox Text="{Binding SoTien, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}"
                                 ToolTip="Số tiền học phí (VND)" />

                        <!-- Ngày đóng -->
                        <Label Content="📆 Ngày đóng *"
                               Foreground="#D32F2F" />
                        <DatePicker SelectedDate="{Binding NgayDong, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    SelectedDateFormat="Short"
                                    Language="vi-VN"
                                    VerticalContentAlignment="Center" />

                        <!-- Ghi chú -->
                        <Label Content="📝 Ghi chú" />
                        <TextBox Text="{Binding GhiChu, UpdateSourceTrigger=PropertyChanged}"
                                 Height="70"
                                 TextWrapping="Wrap"
                                 AcceptsReturn="True"
                                 VerticalScrollBarVisibility="Auto"
                                 VerticalContentAlignment="Top" />

                        <!-- Nút thao tác -->
                        <UniformGrid Columns="2"
                                     Margin="0,25,0,10">
                            <Button Content="➕ Thêm"
                                    Command="{Binding AddCommand}"
                                    Background="#28A745"
                                    Foreground="White"
                                    BorderBrush="#28A745" />
                            <Button Content="✏️ Sửa"
                                    Command="{Binding UpdateCommand}"
                                    Background="#FFC107"
                                    Foreground="White"
                                    BorderBrush="#FFC107" />
                            <Button Content="🗑️ Xóa"
                                    Command="{Binding DeleteCommand}"
                                    Background="#DC3545"
                                    Foreground="White"
                                    BorderBrush="#DC3545" />
                            <Button Content="🆕 Làm trống"
                                    Command="{Binding ClearCommand}"
                                    Background="#6C757D"
                                    Foreground="White"
                                    BorderBrush="#6C757D" />
                        </UniformGrid>

                        <TextBlock Text="* Trường bắt buộc"
                                   FontStyle="Italic"
                                   Foreground="#DC3545"
                                   Margin="0,10,0,0"
                                   HorizontalAlignment="Center"
                                   FontSize="12" />
                    </StackPanel>
                </ScrollViewer>
            </GroupBox>

            <!-- ===== DataGrid ===== -->
            <GroupBox Grid.Column="1"
                      BorderBrush="#90CAF9"
                      BorderThickness="2">
                <GroupBox.Header>
                    <TextBlock Text="📊 DANH SÁCH HỌC PHÍ"
                               FontSize="16"
                               FontWeight="Bold"
                               Foreground="#1976D2"
                               Margin="5" />
                </GroupBox.Header>

                <DataGrid ItemsSource="{Binding FilteredHocPhiList}"
                          SelectedItem="{Binding SelectedHocPhi, Mode=TwoWay}"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          IsReadOnly="True"
                          RowHeaderWidth="0"
                          HeadersVisibility="Column"
                          CanUserResizeColumns="True"
                          BorderBrush="#90CAF9"
                          BorderThickness="1"
                          GridLinesVisibility="All"
                          HorizontalGridLinesBrush="#E0E0E0"
                          VerticalGridLinesBrush="#E0E0E0"
                          AlternationCount="2"
                          RowBackground="White"
                          AlternatingRowBackground="#FAFAFA"
                          ScrollViewer.VerticalScrollBarVisibility="Auto"
                          ScrollViewer.HorizontalScrollBarVisibility="Auto"
                          VirtualizingPanel.IsVirtualizing="True"
                          VirtualizingPanel.VirtualizationMode="Recycling"
                          Margin="10">

                    <!-- Header style -->
                    <DataGrid.ColumnHeaderStyle>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="HorizontalContentAlignment"
                                    Value="Center" />
                            <Setter Property="Background"
                                    Value="#E3F2FD" />
                            <Setter Property="Foreground"
                                    Value="#0D47A1" />
                            <Setter Property="FontWeight"
                                    Value="Bold" />
                            <Setter Property="BorderBrush"
                                    Value="#90CAF9" />
                            <Setter Property="BorderThickness"
                                    Value="0,0,1,1" />
                            <Setter Property="Padding"
                                    Value="8,6" />
                            <Setter Property="FontSize"
                                    Value="13" />
                        </Style>
                    </DataGrid.ColumnHeaderStyle>

                    <!-- Cell styles -->
                    <DataGrid.Resources>
                        <Style x:Key="CellTextStyle"
                               TargetType="TextBlock">
                            <Setter Property="Padding"
                                    Value="8,4" />
                            <Setter Property="VerticalAlignment"
                                    Value="Center" />
                            <Setter Property="TextTrimming"
                                    Value="CharacterEllipsis" />
                        </Style>

                        <Style x:Key="CenterCellStyle"
                               TargetType="TextBlock"
                               BasedOn="{StaticResource CellTextStyle}">
                            <Setter Property="TextAlignment"
                                    Value="Center" />
                        </Style>

                        <Style x:Key="RightCellStyle"
                               TargetType="TextBlock"
                               BasedOn="{StaticResource CellTextStyle}">
                            <Setter Property="TextAlignment"
                                    Value="Right" />
                            <Setter Property="FontWeight"
                                    Value="SemiBold" />
                        </Style>

                        <Style TargetType="DataGridRow">
                            <Setter Property="BorderBrush"
                                    Value="#E0E0E0" />
                            <Setter Property="BorderThickness"
                                    Value="0,0,0,1" />
                            <Style.Triggers>
                                <Trigger Property="IsSelected"
                                         Value="True">
                                    <Setter Property="Background"
                                            Value="#E3F2FD" />
                                    <Setter Property="BorderBrush"
                                            Value="#2196F3" />
                                    <Setter Property="BorderThickness"
                                            Value="2" />
                                </Trigger>
                                <Trigger Property="IsMouseOver"
                                         Value="True">
                                    <Setter Property="Background"
                                            Value="#F5F5F5" />
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.Resources>

                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID"
                                            Binding="{Binding Id}"
                                            Width="50"
                                            ElementStyle="{StaticResource CenterCellStyle}" />

                        <DataGridTextColumn Header="Mã ĐK"
                                            Binding="{Binding DangKyId}"
                                            Width="60"
                                            ElementStyle="{StaticResource CenterCellStyle}" />

                        <DataGridTextColumn Header="Tên học viên"
                                            Binding="{Binding HoTen}"
                                            Width="140"
                                            ElementStyle="{StaticResource CellTextStyle}" />

                        <DataGridTextColumn Header="Lớp học"
                                            Binding="{Binding TenLop}"
                                            Width="120"
                                            ElementStyle="{StaticResource CellTextStyle}" />

                        <DataGridTextColumn Header="Kỳ"
                                            Binding="{Binding KyThu}"
                                            Width="45"
                                            ElementStyle="{StaticResource CenterCellStyle}" />

                        <DataGridTextColumn Header="Buổi"
                                            Binding="{Binding SoBuoi}"
                                            Width="50"
                                            ElementStyle="{StaticResource CenterCellStyle}" />

                        <DataGridTextColumn Header="Số tiền"
                                            Binding="{Binding SoTien, StringFormat=N0}"
                                            Width="100"
                                            ElementStyle="{StaticResource RightCellStyle}" />

                        <DataGridTextColumn Header="Ngày đóng"
                                            Binding="{Binding NgayDong, StringFormat={}{0:dd/MM/yyyy}}"
                                            Width="90"
                                            ElementStyle="{StaticResource CenterCellStyle}" />

                        <DataGridTextColumn Header="Ghi chú"
                                            Binding="{Binding GhiChu}"
                                            Width="*"
                                            ElementStyle="{StaticResource CellTextStyle}" />
                    </DataGrid.Columns>
                </DataGrid>
            </GroupBox>
        </Grid>
    </Grid>
</UserControl>